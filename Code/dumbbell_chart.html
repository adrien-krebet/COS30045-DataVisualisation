<html>
  <head>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
    <div class="navbar">
        <div class="initial">
            <a class="link" href=line_chart.html><span>Line</span></a>            
            <a class="link active" href=dumbbell_chart.html><span>Dumbbell</span></a>
            <a class="link" href=main.html><span>Map</span></a>
        </div>
    </head>
<body>
    <h1>Life Expectancy - Male and Female by Country</h1>
    <div id="dumbbell"></div>
    <footer style="color:grey">COS30045 Data Visualisation<br>Semester 1 2024<br>Adrien Krebet</footer>

    <script>
        var w = 800;
        var h = 500;
        var padding = 50;

        d3.csv("male_atbirth.csv").then(function(maleData) {
            d3.csv("female_atbirth.csv").then(function(femaleData) {
                var dataset = [];

                maleData.forEach(function(male) {
                    var female = femaleData.find(f => f.Country === male.Country);
                    if (female && male["2011"] && female["2011"]) {
                        dataset.push([male.Country, +male["2011"], +female["2011"]]);
                    }
                });

                dumbbellChart(dataset);
            });
        });

        function dumbbellChart(dataset) {
            var svg = d3.select("#dumbbell")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

            var xScale = d3.scaleBand()
                .domain(dataset.map(function(d) { return d[0]; }))
                .range([padding, w - padding])
                .padding(0.1);

            var yScale = d3.scaleLinear()
                .domain([d3.min(dataset, function(d) { return Math.min(d[1], d[2]); }), 
                         d3.max(dataset, function(d) { return Math.max(d[1], d[2]); })])
                .range([h - padding, padding]);

            var xAxis = d3.axisBottom(xScale);
            var yAxis = d3.axisLeft(yScale);

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - padding) + ")")
                .call(xAxis)
                .selectAll("text")
                .attr("transform", "rotate(-90)")
                .attr("dx", "-.8em")
                .attr("dy", "-.5em")
                .style("text-anchor", "end");

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + padding + ",0)")
                .call(yAxis);

            svg.selectAll(".line")
                .data(dataset)
                .enter()
                .append("line")
                .attr("class", "line")
                .attr("x1", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
                .attr("x2", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
                .attr("y1", function(d) { return yScale(d[1]); })
                .attr("y2", function(d) { return yScale(d[2]); });

            svg.selectAll(".circleMale")
                .data(dataset)
                .enter()
                .append("circle")
                .attr("class", "circleMale")
                .attr("cx", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
                .attr("cy", function(d) { return yScale(d[1]); })
                .attr("r", 5);

            svg.selectAll(".circleFemale")
                .data(dataset)
                .enter()
                .append("circle")
                .attr("class", "circleFemale")
                .attr("cx", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
                .attr("cy", function(d) { return yScale(d[2]); })
                .attr("r", 5);

            svg.selectAll(".label")
                .data(dataset)
                .enter()
                .append("text")
                .attr("class", "label")
                .text(function(d) { return d[1] + "," + d[2]; })
                .attr("x", function(d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
                .attr("y", function(d) { return (yScale(d[1]) + yScale(d[2])) / 2 - 10; })
                .attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("text-anchor", "middle")
                .attr("fill", "black");

        }
    </script>
</body>
</html>
