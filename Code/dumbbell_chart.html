<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .line {
        fill: none;
        stroke-width: 2;
        stroke: black;
    }

    .hovered {
        stroke: red;
        stroke-width: 2px;
    }

    .tooltip {
        position: absolute;
        text-align: center;
        width: auto;
        height: auto;
        padding: 8px;
        font: 12px sans-serif;
        background: lightgrey;
        border: 0px;
        border-radius: 4px;
        pointer-events: none;
        opacity: 0;
    }

    .circleMale {
        fill: blue;
    }

    .circleFemale {
        fill: pink;
    }

    .circleDifference {
        fill: green;
    }

    .slider-handle {
        fill: red;
        cursor: pointer;
    }

    .axis path,
    .axis line {
        fill: none;
        shape-rendering: crispEdges;
    }

    #container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #dumbbell {
        width: 100%;
    }

    #timeline {
        width: 100%;
        margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="initial">
      <a class="link" href="line_chart.html"><span>Line</span></a>
      <a class="link active" href="dumbbell_chart.html"><span>Dumbbell</span></a>
      <a class="link" href="main.html"><span>Map</span></a>
    </div>
  </div>

  <h2>The Difference in Life Expectancy Between Men and Women in Different Countries</h2>
  <p>Hover your mouse over the dots to see the exact values</p>
  
  <div id="container">
    <div id="dumbbell"></div>
    <div id="timeline"></div>
  </div>

  <div class="tooltip" id="tooltip"></div>
  
  <script>
    var w = 1000;
    var h = 600; 
    var padding = 50;
    var bottomPadding = 90; 
    var selectedYear = 2011; // Initially selected year

    var yMin = 50; 
    var yMax = 90;

    d3.csv("male_atbirth.csv").then(function(maleData) {
      d3.csv("female_atbirth.csv").then(function(femaleData) {
        var dataset = [];

        maleData.forEach(function(male) {
          var female = femaleData.find(f => f.Country === male.Country);
          if (female) {
            var data = { "Country": male.Country };
            for (var year = 2011; year <= 2019; year++) {
              data[year] = {
                "Male": +male[year],
                "Female": +female[year],
                "Difference": Math.abs(+male[year] - +female[year])
              };
            }
            dataset.push(data);
          }
        });

        dumbbellChart(dataset);
      });
    });

    function dumbbellChart(dataset) {
      var svg = d3.select("#dumbbell")
        .append("svg")
        .attr("width", w)
        .attr("height", h);

      var xScale = d3.scaleBand()
        .range([padding, w - padding])
        .padding(0.1);

      var yScale = d3.scaleLinear()
        .domain([yMin, yMax])
        .range([h - padding - bottomPadding, padding]);

      var xAxis = d3.axisBottom(xScale);
      var yAxis = d3.axisLeft(yScale);

      var xAxisGroup = svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + (h - padding - bottomPadding) + ")");

      var yAxisGroup = svg.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(" + padding + ",0)");

      function updateChart(selectedYear) {
        var data = dataset.map(function(d) {
          return [d.Country, d[selectedYear].Male, d[selectedYear].Female, d[selectedYear].Difference];
        });

        xScale.domain(data.map(function(d) { return d[0]; }));

        xAxisGroup.call(xAxis)
          .selectAll("text")
          .attr("transform", "rotate(-45)")
          .attr("x", -8)
          .attr("y", 0)
          .style("text-anchor", "end");

        var circles = svg.selectAll("circle")
          .data(data)
          .enter()
          .append("circle")
          .attr("class", "circleMale")
          .attr("cx", function(d) { return xScale(d[0]) + (xScale.bandwidth() / 4); })
          .attr("cy", function(d) { return yScale(d[1]); })
          .attr("r", 5)
          .on("mouseover", function(event, d) {
            d3.select(this).attr("class", "hovered");
            tooltip.style("opacity", 1)
              .html(d[0] + "<br>Male: " + d[1] + "<br>Female: " + d[2] + "<br>Difference: " + d[3])
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 30) + "px");
          })
          .on("mouseout", function() {
            d3.select(this).attr("class", "circleMale");
            tooltip.style("opacity", 0);
          });

        var circles2 = svg.selectAll(".circleFemale")
          .data(data)
          .enter()
          .append("circle")
          .attr("class", "circleFemale")
          .attr("cx", function(d) { return xScale(d[0]) + (xScale.bandwidth() / 1.3); })
          .attr("cy", function(d) { return yScale(d[2]); })
          .attr("r", 5)
          .on("mouseover", function(event, d) {
            d3.select(this).attr("class", "hovered");
            tooltip.style("opacity", 1)
              .html(d[0] + "<br>Male: " + d[1] + "<br>Female: " + d[2] + "<br>Difference: " + d[3])
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 30) + "px");
          })
          .on("mouseout", function() {
            d3.select(this).attr("class", "circleFemale");
            tooltip.style("opacity", 0);
          });

        var circles3 = svg.selectAll(".circleDifference")
          .data(data)
          .enter()
          .append("circle")
          .attr("class", "circleDifference")
          .attr("cx", function(d) { return xScale(d[0]) + (xScale.bandwidth() / 2); })
          .attr("cy", function(d) { return yScale(d[3]); })
          .attr("r", 5)
          .on("mouseover", function(event, d) {
            d3.select(this).attr("class", "hovered");
            tooltip.style("opacity", 1)
              .html(d[0] + "<br>Male: " + d[1] + "<br>Female: " + d[2] + "<br>Difference: " + d[3])
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 30) + "px");
          })
          .on("mouseout", function() {
            d3.select(this).attr("class", "circleDifference");
            tooltip.style("opacity", 0);
          });

        svg.append("text")
          .attr("x", (w / 2))
          .attr("y", (padding / 2))
          .attr("text-anchor", "middle")
          .style("font-size", "16px")
          .style("text-decoration", "underline")
          .text("Life Expectancy Difference (Male - Female)");

        svg.append("text")
          .attr("x", (w / 2))
          .attr("y", (h - padding / 3))
          .attr("text-anchor", "middle")
          .style("font-size", "16px")
          .text("Country");

        svg.append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 0 - padding)
          .attr("x", 0 - (h / 2))
          .attr("dy", "1em")
          .style("text-anchor", "middle")
          .style("font-size", "16px")
          .text("Life Expectancy");

        var tooltip = d3.select("#tooltip");

        d3.select("#timeline")
          .selectAll("input")
          .data(d3.range(2011, 2020))
          .enter()
          .append("input")
          .attr("type", "radio")
          .attr("name", "year")
          .attr("value", function(d) { return d; })
          .property("checked", function(d) { return d === selectedYear; })
          .on("change", function(event) {
            selectedYear = parseInt(event.target.value);
            updateChart(selectedYear);
          });
      }

      updateChart(selectedYear);
    }
  </script>
</body>
</html>
